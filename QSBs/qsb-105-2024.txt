
             ---===[ Qubes Security Bulletin 105 ]===---

                              2024-10-17

    Missing enforced decorations for stubdomain windows under KDE

User action
------------

Continue to update normally [1] in order to receive the security updates
described in the "Patching" section below. No other user action is
required in response to this QSB.

Summary
--------

Qubes OS enforces a decoration of displayed windows, such that the user
can recognize which window is controlled by which qube. This applies
both to normal windows with a titlebar as well as other windows (those
are usually used for things like a menu, which behind the scene is a
separate window). For normal windows the titlebar and border of the
window that is drawn by the window manager is colored in the qube's
color label and the title is prefixed with the qube's name in brackets.
Windows without a titlebar get a colored border.

Qubes running in HVM mode can optionally use an emulated display instead
of the seamless Qubes GUI integration. This emulation is done by QEMU
running in a so-called stubdomain, a little helper VM running beside the
actual VM.

Due to an error, when running under KDE, the GUI daemon process
responsible for handling the GUI requests comming from the stubdomain
wasn't instructed to set the window properties as required by KDE to
display the title prefix and colored window decoration.

Impact
-------

An attacker that is able to compromise an HVM qube's stubdomain by
exploiting another bug can create windows that get the same decoration
as normal windows from an application running in dom0. This includes
setting a window title without an enforced prefix. This might be used to
fool the user to think the window belongs to dom0 or another qube (by
prefixing it with that qubes's name).

The attacker can't control the decoration color of those windows, they
will always use the default of the theme of the window manager in dom0.
The windows' icon (by default displayed on the titlebar and in the task
switcher) will still be correctly colored in the qube's color label. Any
window without a titlebar will also get a correctly colored border.

Affected systems
-----------------

Only users that use KDE as window manager are affected (the default is
Xfce).

Only qube's running in HVM mode are affected. In default configuration
that are sys-net and sys-usb.

There's one uncommon exception: an HVM qube that has the 'gui-emulated'
feature set to '' (the empty string, not to be confused with an unset
feature) and for which the 'debug' property is false is not affected,
since it can not get a GUI daemon started for it's stubdomain (unless
the users manuall requests that).

Patching
---------

The following packages contain security updates that address the
vulnerabilities described in this bulletin:

  For Qubes 4.2, in dom0:
  - python3-qubesadmin version 4.2.15? TODO

These packages will migrate from the security-testing repository to the
current (stable) repository over the next two weeks after being tested
by the community. [2] Once available, the packages are to be installed
via the Qubes Update tool or its command-line equivalents. [1]

In order for the update to take effect the graphical user session in
dom0 needs to be restarted for, either by logging out and in again or by
a full restart of the system.

Credits
--------

The bug was reported by Yaroslav Bolyukin.

References
-----------

[1] https://www.qubes-os.org/doc/how-to-update/
[2] https://www.qubes-os.org/doc/testing/

--
The Qubes Security Team
https://www.qubes-os.org/security/
