
             ---===[ Qubes Security Bulletin 091 ]===---

                                TODO

             Potentially compromised Windows PV drivers

User action required
---------------------

At the time of this advisory, no user action is required, but users
may wish to consider discontinuing the use of Qubes Windows Tools in
security-sensitive Windows qubes until a fix is available.


Summary
--------

On 2023-07-24, the Xen Project published Xen Security Notice 1
"winpvdrvbuild.xenproject.org potentially compromised"[3]:

| Software running on the Xen Project hosted subdomain
| winpvdrvbuild.xenproject.org is outdated and vulnerable to several
| CVEs.  Some of the reported issues include remote code execution.  The
| affected host was running the Jenkins build system for the Windows PV
| Drivers subproject.
| 
| Since the list of CVEs reported include remote code execution we no
| longer have confidence that binaries previously available at:
| 
| https://xenbits.xen.org/pvdrivers/win/
| 
| are trustworthy.  This includes binaries signed with Xen Project's EV
| key that is cross-signed by Microsoft.

Qubes Windows Tools includes those binaries, specifically Xen PV
drivers version 8.2.2. 


Impact
-------

If the PV drivers binaries were compromised at build time, any Windows
qube that have Qubes Windows Tools installed may be compromised too.
If the drivers were not compromised at that time, there is no known
vulnerability.
Dom0 is not affected even though qubes-windows-tools package is
installed in dom0, as dom0 (nor the dom0 package build process) does
not interpret the driver files, it only makes them the available for
select Windows qubes.


Discussion
-----------

Qubes Windows Tools include official PV drivers binaries (version
8.2.2, released in April 2019). It is done this way, instead of
building them from source, because official binaries are signed with a
key accepted by Windows by default. This way, it isn't necessary to
enable "testsigning" to install the drivers. This approach is used by
all versions of QWT released for Qubes OS 4.0 and 4.1. Initial QWT for
Qubes OS 4.0 used version 8.2.1 of the PV drivers, released in May
2017.

Qubes Security Team does not currently have definite knowledge if Xen
PV drivers versions 8.2.2 or 8.2.1 indeed were compromised, but as
explained in XSN-1, there is such possibility. 
But, if hypothetical attacker did not compromise the drivers at the
build time, they couldn't be tampered with later because they are
stored on another system, and they are signed with a timestamped
signature that proves they weren't modified after that date.

Currently, Xen Project did not published replacement drivers signed
with Microsoft-approved key. The process for doing this has changed[4]
since previous PV drivers release, and there is no information if or
when new signed PV drivers binaries will be available.

Qubes Team is working on a permanent solution for signed PV drivers in
QWT. When such solution will be available, it will be announced
separately.

Until that happens, the qubes-windows-tools package will be replaced
with a dummy one, containing just a warning text.

Credits
--------

See the original Xen Security Notice.

References
-----------

[1] https://www.qubes-os.org/doc/testing/
[2] https://www.qubes-os.org/doc/how-to-update/
[3] https://lists.xenproject.org/archives/html/xen-announce/2023-07/msg00000.html
[4] https://learn.microsoft.com/en-us/windows-hardware/drivers/install/deprecation-of-software-publisher-certificates-and-commercial-release-certificates

--
The Qubes Security Team
https://www.qubes-os.org/security/
